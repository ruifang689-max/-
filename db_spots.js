/**
 * db_spots.js - æ™¯é»èˆ‡è·¯ç·šè³‡æ–™åº« (v300)
 * åŒ…å«ï¼šå…¨åŸŸè®Šæ•¸åˆå§‹å€¼ã€æ™¯é»åº§æ¨™ã€ç†±é–€è·¯ç·šè¨­å®š
 */

// =========================================
// 1. å…¨åŸŸè®Šæ•¸åˆå§‹é…ç½® (Global State)
// =========================================
var targetSpot = null; 
var currentRoute = null; 
var userPos = null; 
var userMarker = null; 
var currentEditingSpotName = "";
var navMode = 'driving'; 
var tourModeInterval = null; 

// å¾ LocalStorage è®€å–ä½¿ç”¨è€…è³‡æ–™
var myFavs = JSON.parse(localStorage.getItem('ruifang_favs')) || []; 
var savedCustomSpots = JSON.parse(localStorage.getItem('ruifang_custom_spots')) || []; 
var searchHistory = JSON.parse(localStorage.getItem('ruifang_search_history')) || []; 

// =========================================
// 2. æ™¯é»è³‡æ–™åº« (Spots Database)
// =========================================
const spots = [
    { name: "ç‘èŠ³ç«è»Šç«™", wikiTitle: "ç‘èŠ³è»Šç«™", lat: 25.108, lng: 121.805, tags: ["äº¤é€š", "ç¾é£Ÿ"], keywords: ["è»Šç«™", "é¾é³³è…¿", "èƒ¡æ¤’é¤…"], highlights: "ç‘èŠ³ç¾é£Ÿå»£å ´", food: "é¾é³³è…¿ã€èƒ¡æ¤’é¤…", history: "å¹³æºªç·šèˆ‡ä¹ä»½çš„äº¤é€šè½‰é‹æ¨ç´ã€‚", transport: "å°éµç‘èŠ³ç«™" },
    { name: "ç‘èŠ³å¾Œç«™è€è¡—", wikiTitle: "ç‘èŠ³è€è¡—", lat: 25.109, lng: 121.806, tags: ["æ­·å²", "ç¾é£Ÿ"], keywords: ["ä¿é›²èŠ‹åœ“", "è€è¡—"], highlights: "ç‘èŠ³å‰µå§‹èŠ‹åœ“", food: "ä¿é›²èŠ‹åœ“", history: "æ—©æœŸç¤¦å·¥çš„èšé›†åœ°ã€‚", transport: "æ­¥è¡Œè‡ªå¾Œç«™" },
    { name: "ä¹ä»½è€è¡—", wikiTitle: "ä¹ä»½", lat: 25.1099, lng: 121.8452, tags: ["æ­·å²", "ç¾é£Ÿ"], keywords: ["é˜¿å¦¹èŒ¶æ¨“", "èŠ‹åœ“", "å±±åŸ"], highlights: "é˜¿å¦¹èŒ¶æ¨“ã€è±å´è·¯", food: "é˜¿æŸ‘å§¨èŠ‹åœ“", history: "æ›¾ç¶“ç¹è¯çš„é»ƒé‡‘å±±åŸã€‚", transport: "å®¢é‹ 788/965" },
    { name: "çŒ´ç¡è²“æ‘", wikiTitle: "çŒ´ç¡è²“æ‘", lat: 25.086, lng: 121.828, tags: ["æ­·å²"], keywords: ["è²“", "ç‘ä¸‰æ•´ç…¤å» "], highlights: "è²“å’ªç™‚ç™’ã€ç…¤ç¤¦éºè·¡", food: "ç¤¦å·¥éºµ", history: "æ›¾ç‚ºå…¨å°ç…¤ç¤¦ç”¢é‡ç¬¬ä¸€ã€‚", transport: "å°éµçŒ´ç¡ç«™" },
    { name: "é‡‘ç“œçŸ³é»ƒé‡‘åšç‰©é¤¨", wikiTitle: "æ–°åŒ—å¸‚ç«‹é»ƒé‡‘åšç‰©é¤¨", lat: 25.1091, lng: 121.8576, tags: ["æ­·å²"], keywords: ["é‡‘ç“œçŸ³", "ç¤¦å·¥ä¾¿ç•¶"], highlights: "å¤§é‡‘ç£šã€æœ¬å±±äº”å‘", food: "ç¤¦å·¥ä¾¿ç•¶", history: "äºæ´²ç¬¬ä¸€é‡‘ç¤¦å±±ã€‚", transport: "å®¢é‹ 788/856" },
    { name: "ç„¡è€³èŒ¶å£ºå±±", wikiTitle: "ç„¡è€³èŒ¶å£ºå±±", lat: 25.1063, lng: 121.8659, tags: ["è‡ªç„¶"], keywords: ["æµ·æ™¯", "çˆ¬å±±"], highlights: "çµ•ç¾æµ·æ™¯", food: "ç„¡", history: "å±±å½¢ä¼¼ç„¡è€³èŒ¶å£ºã€‚", transport: "é‡‘ç“œçŸ³æ­¥è¡Œç™»å±±" },
    { name: "å ±æ™‚å±±æ­¥é“", wikiTitle: "", lat: 25.1118, lng: 121.8587, tags: ["è‡ªç„¶"], keywords: ["è§€æ™¯å°", "æ­¥é“"], highlights: "æœ€è¼•é¬†çœ‹æµ·æ­¥é“", food: "ç„¡", history: "æ—¥æ²»æ™‚æœŸè¨­æœ‰è­¦å ±å™¨ã€‚", transport: "å‹¸æ¿Ÿå ‚æ­¥è¡Œ" },
    { name: "æ°´æ¹³æ´é™°é™½æµ·", wikiTitle: "é™°é™½æµ·", lat: 25.1228, lng: 121.8647, tags: ["è‡ªç„¶"], keywords: ["æµ·æ™¯", "åä¸‰å±¤éºå€"], highlights: "é»ƒè—äº¤éŒ¯æµ·æ™¯", food: "ç„¡", history: "ç¤¦ç‰©æ°§åŒ–å½¢æˆçš„è‡ªç„¶å¥‡è§€ã€‚", transport: "å®¢é‹ 856" }
];

// =========================================
// 3. ç†±é–€è·¯ç·šè³‡æ–™ (Routes Data)
// =========================================
const routesData = {
    'history': { name: "ğŸ›ï¸ æ­·å²æ‡·èˆŠç·š", desc: "ç‘èŠ³è»Šç«™ â” å¾Œç«™è€è¡— â” ä¹ä»½è€è¡— â” é»ƒé‡‘åšç‰©é¤¨", coords: [[25.108, 121.805], [25.109, 121.806], [25.1099, 121.8452], [25.1091, 121.8576]], color: '#8e44ad' },
    'nature': { name: "â›°ï¸ å±±æµ·è‡ªç„¶ç·š", desc: "ç‘èŠ³è»Šç«™ â” çŒ´ç¡è²“æ‘ â” å ±æ™‚å±±æ­¥é“ â” é™°é™½æµ·", coords: [[25.108, 121.805], [25.086, 121.828], [25.1118, 121.8587], [25.1228, 121.8647]], color: '#27ae60' },
    'food': { name: "ğŸœ é¥•å®¢ç¾é£Ÿç·š", desc: "ç‘èŠ³ç¾é£Ÿå»£å ´ â” é˜¿æŸ‘å§¨èŠ‹åœ“ â” ç¤¦å·¥ä¾¿ç•¶", coords: [[25.108, 121.805], [25.1099, 121.8452], [25.1091, 121.8576]], color: '#d35400' }
};

// é è¨­è·¯ç·šåº§æ¨™ (å‘ä¸‹ç›¸å®¹)
const themeRouteCoords = routesData['history'].coords;
