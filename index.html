<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>ç‘èŠ³å°è¦½åœ°åœ– App</title>

    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for(let registration of registrations) { registration.unregister(); }
            });
        }
    </script>

    <meta property="og:title" content="ç‘èŠ³å°è¦½åœ°åœ–" />
    <meta property="og:description" content="æ¢ç´¢ç‘èŠ³ç§˜å¢ƒã€åœ¨åœ°ç¾é£Ÿèˆ‡æ™‚ç©ºæ—…äººè·¯ç·šçš„å°ˆå±¬æ™ºæ…§åœ°åœ–ï¼" />
    <meta property="og:type" content="website" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster/dist/MarkerCluster.Default.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#ffffff"> 
    <link rel="apple-touch-icon" href="icon/icon-192.png">
    <link rel="icon" type="image/png" href="icon/icon-192.png">
    
    <link rel="stylesheet" href="style.css?v=500">
</head>
<body id="main-body">

    <div id="splash-screen">
        <div class="logo-anim">ç‘</div>
        <div class="splash-title-text" data-i18n="splash_title">ç‘èŠ³å°è¦½ App</div>
    </div>
    
    <div id="welcome-screen">
        <div class="welcome-wrapper">
            <div class="logo-static">ç‘</div>
            <h1 class="welcome-title" data-i18n="splash_title">ç‘èŠ³å°è¦½ App</h1>
            <p class="welcome-desc" data-i18n="splash_desc">ç²¾æº–åœ¨åœ°å°è¦½ï¼Œæ·±åº¦æ¢ç´¢å±±åŸã€‚</p>
            <div class="input-group">
                <label data-i18n="lang">èªè¨€ / Language</label>
                <select id="lang-select-startup" class="welcome-select" onchange="applyLanguage(this.value)">
                    <option value="zh">ç¹é«”ä¸­æ–‡</option><option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option><option value="ko">í•œêµ­ì–´</option><option value="vi">Tiáº¿ng Viá»‡t</option>
                </select>
            </div>
            <div class="link-box">
                <a href="#" onclick="openSettings()"><i class="fas fa-cog"></i> <span data-i18n="settings">ç³»çµ±è¨­å®š</span></a>
                <a href="https://docs.google.com/forms/d/e/1FAIpQLSdX4uBvH_nN1fVzB-2j8P2_P9L1D-_E-_1T2O5S_g-_c-_6_w/viewform?usp=header" target="_blank"><i class="fas fa-edit"></i> <span data-i18n="feedback_title">æ¸¬è©•å•å·èˆ‡è¯çµ¡</span></a>
            </div>
            <button class="btn-enter-map" onclick="enterMap()" data-i18n="enter_map">é€²å…¥åœ°åœ–</button>
        </div>
    </div>

    <div id="map"></div>
    <div id="gps-val-text">GPS: --</div>

    <div id="weather-box" title="å³æ™‚å¤©æ°£"><i class="fas fa-spinner fa-spin"></i><span id="weather-temp">--</span></div>

    <div id="top-ui">
        <div id="search-container" style="width: 100%; position: relative;">
            <input id="search" placeholder="ğŸ” æœå°‹æˆ–é•·æŒ‰æ–°å¢..." data-i18n="search_ph">
            <i id="search-clear-btn" class="fas fa-times-circle" onclick="clearSearchInput()" style="position: absolute; right: 12px; top: 50%; transform: translateY(-50%); color: #aaa; cursor: pointer; display: none;"></i>
        </div>
        <div id="category-chips">
            <div class="chip active" onclick="filterSpots('all', this)" data-i18n="chip_all">ğŸŒŸ å…¨éƒ¨</div>
            <div class="chip" onclick="filterSpots('ç¾é£Ÿ', this)" data-i18n="chip_food">ğŸœ ç¾é£Ÿ</div>
            <div class="chip" onclick="filterSpots('æ­·å²', this)" data-i18n="chip_history">ğŸ›ï¸ æ­·å²</div>
            <div class="chip" onclick="filterSpots('è‡ªç„¶', this)" data-i18n="chip_nature">â›°ï¸ è‡ªç„¶</div>
            <div class="chip" onclick="filterSpots('è‡ªè¨‚', this)" data-i18n="chip_custom">ğŸ“ æ¨™è¨˜</div>
        </div>
        <div id="map-center-panel"><i class="fas fa-map-marker-alt" style="color:var(--primary)"></i><span id="addr-text" data-i18n="locating">å®šä½ä¸­...</span></div>
        <div id="suggest">
            <div class="suggest-header"><span style="font-size:12px; font-weight:bold; color:var(--text-sub);">æ¨è–¦</span> <i class="fas fa-times" style="cursor:pointer;" onclick="closeSuggest()"></i></div>
            <div id="suggest-content"></div>
        </div>
    </div>

    <div class="map-controls">
        <div id="layer-btn" class="control-btn" onclick="toggleLayer()" title="åˆ‡æ›åœ°åœ–"><i class="fas fa-map"></i></div>
        <div class="control-btn compass-btn" onclick="resetNorth()" title="æŒ‡åŒ—"><i class="fas fa-compass"></i></div>
        <div class="control-btn route-btn" onclick="openRouteMenu()" title="æ¨è–¦è·¯ç·š"><i class="fas fa-route"></i></div>
        <div class="control-btn fav-btn" onclick="toggleFavList()" title="æˆ‘çš„æ”¶è—"><i class="fas fa-heart"></i></div>
        <div class="control-btn" onclick="goToStation()" title="å›åˆ°è»Šç«™" style="background:var(--bg-color);"><span class="rui-icon">ç‘</span></div>
        <div class="control-btn" onclick="goToUser()" title="æˆ‘çš„ä½ç½®" style="color:var(--primary);"><i class="fas fa-crosshairs"></i></div>
    </div>

    <div id="fav-list-panel"></div>

    <div id="route-info-panel">
        <div class="route-modes">
            <div class="route-mode-btn active" id="mode-driving" onclick="changeNavMode('driving')" title="é–‹è»Š/é¨è»Š"><i class="fas fa-car"></i></div>
            <div class="route-mode-btn" id="mode-walking" onclick="changeNavMode('walking')" title="æ­¥è¡Œ"><i class="fas fa-walking"></i></div>
        </div>
        <div class="route-data">
            <span class="route-time" id="route-time">è¨ˆç®—ä¸­...</span>
            <span class="route-dist" id="route-dist"></span>
        </div>
        <i class="fas fa-times-circle route-close" onclick="closeNav()"></i>
    </div>

    <div id="card">
        <div class="close-bar" onclick="closeCard()"></div>
        <div class="card-header-row">
            <h2 id="title">æ™¯é»åç¨±</h2>
            <div class="card-header-icons">
                <i class="fas fa-share-alt" id="card-share-icon" onclick="shareSpot()"></i>
                <i class="fas fa-heart" id="card-fav-icon" onclick="toggleCurrentFav()"></i>
            </div>
        </div>
        <div id="card-tags"></div>
        <img id="img" src="" alt="æ™¯é»åœ–ç‰‡">
        <div class="info-section"><span class="info-label"><i class="fas fa-utensils"></i> <span data-i18n="food">ç‰¹è‰²</span></span><span class="info-text" id="card-food"></span></div>
        <div class="info-section"><span class="info-label"><i class="fas fa-star"></i> <span data-i18n="highlights">æ¨è–¦äº®é»</span></span><span class="info-text" id="card-highlights"></span></div>
        <div class="info-section"><span class="info-label"><i class="fas fa-book-open"></i> <span data-i18n="history">æ­·å²</span></span><span class="info-text" id="card-history"></span></div>
        <div class="info-section"><span class="info-label"><i class="fas fa-bus"></i> <span data-i18n="transport">äº¤é€š</span></span><span class="info-text" id="card-transport"></span></div>
        <div class="btn-group" id="card-btn-group"></div>
    </div>

    <div id="settings-modal-overlay" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title"><i class="fas fa-cog" style="color:var(--primary);"></i> ç³»çµ±è¨­å®š</h3>
            <div class="input-group">
                <label>èªè¨€ Language</label>
                <select id="lang-select-settings" class="modal-select" onchange="applyLanguage(this.value)">
                    <option value="zh">ç¹é«”ä¸­æ–‡</option><option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option><option value="ko">í•œêµ­ì–´</option><option value="vi">Tiáº¿ng Viá»‡t</option>
                </select>
            </div>
            <div class="input-group">
                <label>ä¸»é¡Œé¡è‰² Theme</label>
                <select id="theme-select" class="modal-select" onchange="changeTheme(this.value)">
                    <option value="default">é è¨­ (ç§‘æŠ€è—)</option><option value="#27ae60">æ£®æ—ç¶ </option>
                    <option value="#e67e22">å¤•é™½æ©˜</option><option value="#8e44ad">ç¥ç§˜ç´«</option>
                    <option value="#e84393">æ«»èŠ±ç²‰</option><option value="custom">è‡ªè¨‚é¡è‰²...</option>
                </select>
                <input type="color" id="custom-color-picker" style="display:none; width:100%; margin-top:10px; height:40px; border:none; cursor:pointer;" onchange="applyCustomTheme(this.value, true)">
            </div>
            <div class="input-group" style="display: flex; align-items: center; justify-content: space-between; padding: 10px; background: var(--divider-color); border-radius: 8px;">
                <label style="margin: 0;">å•Ÿå‹•æ™‚ç•¥éé–‹å ´å‹•ç•«</label>
                <input type="checkbox" id="skip-intro-toggle" onchange="toggleSkipIntro(this.checked)" style="transform: scale(1.3); cursor: pointer;">
            </div>
            <div class="contact-section">
                <a href="#" onclick="reopenTutorial()" class="contact-btn"><i class="fas fa-question-circle"></i> é‡æ–°æŸ¥çœ‹æ•™å­¸</a>
            </div>
            <button class="modal-cancel" style="width: 100%; margin-top: 10px;" onclick="closeSettings()">é—œé–‰</button>
        </div>
    </div>

    <div id="route-select-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title route"><i class="fas fa-route"></i> æ¨è–¦è¡Œç¨‹è·¯ç·š</h3>
            <div class="route-list-container">
                <div class="route-item" onclick="selectRoute('history')"><div class="route-info"><span class="route-name">ğŸ›ï¸ æ­·å²æ‡·èˆŠç·š</span><span class="route-desc">ç‘èŠ³è»Šç«™ â” å¾Œç«™è€è¡— â” ä¹ä»½è€è¡— â” é»ƒé‡‘åšç‰©é¤¨</span></div></div>
                <div class="route-item" onclick="selectRoute('nature')"><div class="route-info"><span class="route-name">â›°ï¸ å±±æµ·è‡ªç„¶ç·š</span><span class="route-desc">ç‘èŠ³è»Šç«™ â” çŒ´ç¡è²“æ‘ â” å ±æ™‚å±±æ­¥é“ â” é™°é™½æµ·</span></div></div>
                <div class="route-item" onclick="selectRoute('food')"><div class="route-info"><span class="route-name">ğŸœ é¥•å®¢ç¾é£Ÿç·š</span><span class="route-desc">ç‘èŠ³ç¾é£Ÿå»£å ´ â” èŠ‹åœ“ â” ç¤¦å·¥ä¾¿ç•¶</span></div></div>
            </div>
            <button class="modal-cancel" style="width: 100%; margin-top: 15px;" onclick="closeRouteMenu()">é—œé–‰</button>
        </div>
    </div>

    <div id="fav-manage-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title fav"><i class="fas fa-heart"></i> ç®¡ç†æ”¶è—å¤¾</h3>
            <div id="fav-manage-list" style="display:flex; flex-direction:column; gap:10px; max-height: 50vh; overflow-y:auto;"></div>
            <button class="modal-cancel" style="width: 100%; margin-top: 15px;" onclick="closeFavManage()">é—œé–‰</button>
        </div>
    </div>

    <div id="edit-modal-overlay" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title"><i class="fas fa-edit" style="color: var(--primary);"></i> ç·¨è¼¯è‡ªè¨‚æ¨™è¨˜</h3>
            <input type="text" id="edit-name" class="modal-input" placeholder="åœ°é»åç¨± (å¿…å¡«)">
            <textarea id="edit-highlights" class="modal-textarea" placeholder="æ¨è–¦äº®é»..."></textarea>
            <textarea id="edit-history" class="modal-textarea" placeholder="å‚™è¨»æˆ–æ­·å²..."></textarea>
            <label class="modal-file-label"><i class="fas fa-camera"></i> ä¸Šå‚³å°ˆå±¬ç…§ç‰‡<input type="file" id="edit-image" accept="image/*" style="display:none;"></label>
            <img id="edit-image-preview" src="">
            <div class="modal-btns">
                <button class="modal-cancel" onclick="closeEditModal()">å–æ¶ˆ</button>
                <button class="modal-save" onclick="saveEditSpot()">å„²å­˜</button>
            </div>
        </div>
    </div>

    <div id="custom-spot-modal" class="modal-overlay">
        <div class="modal-box">
            <h3 class="modal-title"><i class="fas fa-map-pin" style="color: var(--primary);"></i> æ–°å¢è‡ªè¨‚æ™¯é»</h3>
            <div id="custom-spot-addr" style="font-size: 13px; color: var(--text-sub); margin-bottom: 5px; padding: 12px; background: var(--divider-color); border-radius: 8px; line-height: 1.6; border: 1px solid var(--border-color);">
                ğŸ“ è¼‰å…¥ä¸­...
            </div>
            <input type="text" id="custom-spot-name" class="modal-input" placeholder="è«‹ç‚ºæ­¤ç§˜å¢ƒå‘½å (ä¾‹ï¼šæˆ‘çš„ç§˜å¯†åŸºåœ°)">
            <div class="modal-btns">
                <button class="modal-cancel" onclick="closeCustomSpotModal()">å–æ¶ˆ</button>
                <button class="modal-save" onclick="confirmCustomSpot()">å„²å­˜æ™¯é»</button>
            </div>
        </div>
    </div>

    <div id="tutorial-overlay">
        <div class="tutorial-box" id="tut-step-1">
            <h3 data-i18n="tut_step1_title"><i class="fas fa-book-open"></i> åŠŸèƒ½èªªæ˜ (1/2)</h3>
            <ul>
                <li><b><i class="fas fa-search"></i> <span data-i18n="tut_search">æœå°‹èˆ‡æ¨™ç±¤</span></b>ï¼šæ‰¾æ™¯é»æˆ–åˆ‡æ›ä¸»é¡Œã€‚</li>
                <li><b><i class="fas fa-hand-pointer"></i> <span data-i18n="tut_add">é•·æŒ‰æ–°å¢</span></b>ï¼šé•·æŒ‰åœ°åœ–å¯æ–°å¢è‡ªè¨‚æ™¯é»ã€‚</li>
                <li><b><i class="fas fa-cloud-sun"></i> <span data-i18n="tut_weather">å¤©æ°£è³‡è¨Š</span></b>ï¼šå³ä¸Šè§’å³æ™‚å¤©æ°£ã€‚</li>
            </ul>
            <div class="tutorial-btns">
                <button class="btn-fill" onclick="nextTutorial()" data-i18n="tut_next">ä¸‹ä¸€æ­¥ <i class="fas fa-arrow-right"></i></button>
            </div>
        </div>
        <div class="tutorial-box" id="tut-step-2" style="display: none;">
            <h3 data-i18n="tut_step2_title"><i class="fas fa-rocket"></i> é€²éšåŠŸèƒ½ (2/2)</h3>
            <ul>
                <li><b><i class="fas fa-route"></i> <span data-i18n="tut_nav">è·¯ç·šèˆ‡å°èˆª</span></b>ï¼šæ¨è–¦è·¯ç·šåŠåˆ°é”è¨ˆç®—ã€‚</li>
                <li><b><i class="fas fa-heart"></i> <span data-i18n="tut_settings">æ”¶è—èˆ‡åˆ†äº«</span></b>ï¼šçè—æ™¯é»èˆ‡ç™¼é€é€£çµã€‚</li>
            </ul>
            <div class="tutorial-btns">
                <button class="btn-outline" onclick="prevTutorial()" data-i18n="tut_prev"><i class="fas fa-arrow-left"></i> å‰ä¸€æ­¥</button>
                <button class="btn-fill" onclick="finishTutorial()" data-i18n="tut_finish"><i class="fas fa-check"></i> é–‹å§‹ä½¿ç”¨</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster/dist/leaflet.markercluster.js"></script>
    
    <script type="module" src="./js/main.js?v=500"></script>

    <script>
        setTimeout(() => {
            const splash = document.getElementById('splash-screen');
            if (splash && splash.style.display !== 'none' && splash.style.opacity !== '0') {
                splash.style.display = 'none';
                const welcome = document.getElementById('welcome-screen');
                if (!localStorage.getItem('ruifang_welcomed') && !localStorage.getItem('ruifang_skip_intro') === 'true' && welcome) {
                    welcome.style.display = 'flex'; welcome.style.opacity = '1';
                }
            }
        }, 3000);
    </script>
</body>
</html>
